<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{fragments/head :: head('Task · Tasks')}" />
<body class="bg-surface-0 font-sans text-text-primary min-h-screen" x-data="taskBoard()">

	<!-- Skip link -->
	<a href="#main-content" class="skip-link">Skip to content</a>

	<!-- Sidebar -->
	<th:block th:replace="~{fragments/sidebar :: sidebar}" />
	<!-- Command palette -->
	<th:block th:replace="~{fragments/command-palette :: commandPalette}" />

	<!-- Main content -->
	<div id="main-content" class="lg:pl-[240px] min-h-screen flex flex-col">

		<!-- Top bar -->
		<header class="sticky top-0 z-30 h-14 bg-surface-0/80 backdrop-blur-md border-b border-border-subtle flex items-center px-6 gap-3 shrink-0">
			<!-- Mobile menu -->
			<button @click="$store.sidebar.toggleMobile()" class="lg:hidden text-text-secondary hover:text-text-primary transition-colors" aria-label="Open menu">
				<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
			</button>

			<h1 class="text-base font-semibold text-text-primary">Tasks</h1>

			<div class="flex-1"></div>

			<!-- Search tasks -->
			<div class="hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border border-border bg-surface-2 text-text-tertiary text-sm w-56 cursor-text" @click="$refs.boardSearch.focus()">
				<svg class="w-3.5 h-3.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
				<input x-ref="boardSearch" type="text" placeholder="Filter tasks..." x-model="searchQuery" @input="applyFilters()"
					class="bg-transparent outline-none text-text-primary placeholder-text-tertiary text-sm w-full" aria-label="Filter tasks">
				<kbd class="kbd-hint" x-show="!searchQuery">/</kbd>
			</div>

			<!-- Keyboard shortcuts -->
			<button @click="shortcutsOpen = true" class="p-2 rounded-lg text-text-tertiary hover:text-text-secondary hover:bg-surface-3 transition-colors cursor-pointer hidden sm:flex" title="Keyboard shortcuts" aria-label="Keyboard shortcuts">
				<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
			</button>

			<!-- Refresh -->
			<button id="refreshTasks" class="p-2 rounded-lg text-text-tertiary hover:text-text-secondary hover:bg-surface-3 transition-colors cursor-pointer" title="Refresh (R)" aria-label="Refresh tasks">
				<svg id="refreshIcon" class="w-4.5 h-4.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
			</button>

			<!-- New task button -->
			<button @click="openCreateSheet()" id="newTaskBtn"
				class="inline-flex items-center gap-2 px-4 py-2 bg-accent text-white text-sm font-medium rounded-lg hover:bg-accent-hover transition-colors cursor-pointer">
				<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
				<span class="hidden sm:inline">New Task</span>
				<kbd class="kbd-hint hidden sm:inline-flex ml-1">N</kbd>
			</button>
		</header>

		<!-- Filter chips -->
		<div class="px-6 py-3 border-b border-border-subtle flex items-center gap-2 overflow-x-auto" id="filterBar">
			<span class="text-xs text-text-tertiary font-medium shrink-0">Filter:</span>
			<button class="filter-chip" :class="statusFilter === '' && 'active'" @click="statusFilter = ''; applyFilters()">
				All <span class="chip-count" x-text="allTasks.length"></span>
			</button>
			<button class="filter-chip" :class="statusFilter === 'TODO' && 'active'" @click="statusFilter = statusFilter === 'TODO' ? '' : 'TODO'; applyFilters()">
				<span class="w-2 h-2 rounded-full status-dot-TODO"></span> Todo <span class="chip-count" x-text="countByStatus('TODO')"></span>
			</button>
			<button class="filter-chip" :class="statusFilter === 'DOING' && 'active'" @click="statusFilter = statusFilter === 'DOING' ? '' : 'DOING'; applyFilters()">
				<span class="w-2 h-2 rounded-full status-dot-DOING"></span> In Progress <span class="chip-count" x-text="countByStatus('DOING')"></span>
			</button>
			<button class="filter-chip" :class="statusFilter === 'DONE' && 'active'" @click="statusFilter = statusFilter === 'DONE' ? '' : 'DONE'; applyFilters()">
				<span class="w-2 h-2 rounded-full status-dot-DONE"></span> Done <span class="chip-count" x-text="countByStatus('DONE')"></span>
			</button>
			<div class="border-l border-border-subtle h-5 mx-1 shrink-0"></div>
			<button class="filter-chip" :class="myTasksOnly && 'active'" @click="myTasksOnly = !myTasksOnly; applyFilters()">
				<svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
				My tasks
			</button>
			<template x-if="searchQuery || statusFilter || myTasksOnly">
				<button @click="clearFilters()" class="text-xs text-accent hover:text-accent-hover font-medium ml-auto shrink-0 cursor-pointer">Clear all</button>
			</template>
		</div>

		<!-- Board Skeleton -->
		<div id="boardSkeleton" class="p-6 space-y-3">
			<div class="animate-pulse flex items-center gap-3 px-4 py-3"><div class="w-2 h-2 bg-surface-5 rounded-full"></div><div class="h-3 bg-surface-4 rounded w-12"></div><div class="h-3 bg-surface-3 rounded w-2/3"></div><div class="h-3 bg-surface-3 rounded w-12 ml-auto"></div></div>
			<div class="animate-pulse flex items-center gap-3 px-4 py-3"><div class="w-2 h-2 bg-surface-5 rounded-full"></div><div class="h-3 bg-surface-4 rounded w-12"></div><div class="h-3 bg-surface-3 rounded w-1/2"></div><div class="h-3 bg-surface-3 rounded w-12 ml-auto"></div></div>
			<div class="animate-pulse flex items-center gap-3 px-4 py-3"><div class="w-2 h-2 bg-surface-5 rounded-full"></div><div class="h-3 bg-surface-4 rounded w-12"></div><div class="h-3 bg-surface-3 rounded w-3/4"></div><div class="h-3 bg-surface-3 rounded w-12 ml-auto"></div></div>
			<div class="animate-pulse flex items-center gap-3 px-4 py-3"><div class="w-2 h-2 bg-surface-5 rounded-full"></div><div class="h-3 bg-surface-4 rounded w-12"></div><div class="h-3 bg-surface-3 rounded w-1/3"></div><div class="h-3 bg-surface-3 rounded w-12 ml-auto"></div></div>
			<div class="animate-pulse flex items-center gap-3 px-4 py-3"><div class="w-2 h-2 bg-surface-5 rounded-full"></div><div class="h-3 bg-surface-4 rounded w-12"></div><div class="h-3 bg-surface-3 rounded w-2/5"></div><div class="h-3 bg-surface-3 rounded w-12 ml-auto"></div></div>
		</div>

		<!-- No results -->
		<div x-show="noResults" x-cloak class="flex flex-col items-center justify-center py-20 text-center" id="noResults">
			<svg class="w-10 h-10 text-text-tertiary mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
			<p class="text-sm text-text-secondary font-medium">No tasks match your filters</p>
			<button @click="clearFilters()" class="text-xs text-accent hover:text-accent-hover font-medium mt-2 cursor-pointer">Clear filters</button>
		</div>

		<!-- Kanban Grid -->
		<div id="boardGrid" class="hidden flex-1 grid grid-cols-1 md:grid-cols-3 gap-5 p-6" role="region" aria-label="Task board">
			<div class="column-drop bg-surface-2 rounded-xl p-4 min-h-[400px] flex flex-col border border-border transition-colors" data-status="TODO" role="list" aria-label="Todo tasks">
				<div class="flex items-center justify-between mb-4">
					<div class="flex items-center gap-2.5"><span class="w-2.5 h-2.5 rounded-full status-dot-TODO" aria-hidden="true"></span><h3 class="text-sm font-medium text-text-secondary uppercase tracking-wider">Todo</h3></div>
					<span id="todoCount" class="text-sm font-medium text-text-tertiary bg-surface-3 px-2 py-0.5 rounded">0</span>
				</div>
				<div id="colTodo" class="flex-1 space-y-3 overflow-y-auto"></div>
			</div>
			<div class="column-drop bg-surface-2 rounded-xl p-4 min-h-[400px] flex flex-col border border-border transition-colors" data-status="DOING" role="list" aria-label="In Progress tasks">
				<div class="flex items-center justify-between mb-4">
					<div class="flex items-center gap-2.5"><span class="w-2.5 h-2.5 rounded-full status-dot-DOING" aria-hidden="true"></span><h3 class="text-sm font-medium text-text-secondary uppercase tracking-wider">In Progress</h3></div>
					<span id="doingCount" class="text-sm font-medium text-text-tertiary bg-surface-3 px-2 py-0.5 rounded">0</span>
				</div>
				<div id="colDoing" class="flex-1 space-y-3 overflow-y-auto"></div>
			</div>
			<div class="column-drop bg-surface-2 rounded-xl p-4 min-h-[400px] flex flex-col border border-border transition-colors" data-status="DONE" role="list" aria-label="Done tasks">
				<div class="flex items-center justify-between mb-4">
					<div class="flex items-center gap-2.5"><span class="w-2.5 h-2.5 rounded-full status-dot-DONE" aria-hidden="true"></span><h3 class="text-sm font-medium text-text-secondary uppercase tracking-wider">Done</h3></div>
					<span id="doneCount" class="text-sm font-medium text-text-tertiary bg-surface-3 px-2 py-0.5 rounded">0</span>
				</div>
				<div id="colDone" class="flex-1 space-y-3 overflow-y-auto"></div>
			</div>
		</div>
	</div>

	<!-- ═══════════════════════════════════════
	     SLIDE-OVER SHEET: Create Task
	     ═══════════════════════════════════════ -->
	<div x-show="sheetOpen" x-cloak class="fixed inset-0 z-[100]" @keydown.escape.window="sheetOpen = false" role="dialog" aria-modal="true" aria-label="Create new task">
		<div x-show="sheetOpen" x-transition:enter="transition-opacity ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
			 x-transition:leave="transition-opacity ease-in duration-150" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
			 class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="sheetOpen = false"></div>
		<div x-show="sheetOpen" x-transition:enter="transition-transform ease-out duration-200" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
			 x-transition:leave="transition-transform ease-in duration-150" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full"
			 class="absolute inset-y-0 right-0 w-full max-w-md bg-surface-2 border-l border-border shadow-2xl flex flex-col">
			<!-- Header -->
			<div class="flex items-center justify-between px-6 py-4 border-b border-border-subtle">
				<h2 class="text-base font-semibold text-text-primary">New Task</h2>
				<button @click="sheetOpen = false" class="p-1.5 rounded-lg text-text-tertiary hover:text-text-secondary hover:bg-surface-3 transition-colors cursor-pointer" aria-label="Close">
					<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
				</button>
			</div>
			<!-- Body -->
			<div class="flex-1 overflow-y-auto px-6 py-5">
				<form id="taskForm" class="space-y-5">
					<div>
						<label for="taskTitle" class="block text-sm font-medium text-text-secondary mb-2">Title</label>
						<input id="taskTitle" type="text" required placeholder="Issue title"
							class="w-full px-3 py-2.5 rounded-lg border border-border-strong bg-surface-3 text-sm text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-colors">
					</div>
					<div>
						<label for="taskDescription" class="block text-sm font-medium text-text-secondary mb-2">Description</label>
						<textarea id="taskDescription" rows="4" placeholder="Add a description..."
							class="w-full px-3 py-2.5 rounded-lg border border-border-strong bg-surface-3 text-sm text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-colors resize-none"></textarea>
					</div>
					<div>
						<label for="taskAssignee" class="block text-sm font-medium text-text-secondary mb-2">Assignee</label>
						<select id="taskAssignee"
							class="w-full px-3 py-2.5 rounded-lg border border-border-strong bg-surface-3 text-sm text-text-secondary focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-colors">
							<option value="">Unassigned</option>
						</select>
					</div>
					<p id="taskFormHint" class="text-xs text-amber-400"></p>
				</form>
			</div>
			<!-- Footer -->
			<div class="px-6 py-4 border-t border-border-subtle bg-surface-1">
				<div class="flex items-center justify-end gap-3">
					<button @click="sheetOpen = false" class="px-4 py-2.5 text-sm font-medium text-text-secondary bg-surface-3 border border-border-strong rounded-lg hover:bg-surface-4 transition-colors cursor-pointer">Cancel</button>
					<button type="submit" form="taskForm" id="createTaskBtn"
						class="inline-flex items-center gap-2 px-5 py-2.5 bg-accent text-white text-sm font-semibold rounded-lg hover:bg-accent-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer">
						<span>Create Task</span>
						<svg id="createTaskSpinner" class="hidden animate-spin h-4 w-4 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- ═══════════════════════════════════════
	     MODAL: Task Detail / Edit
	     ═══════════════════════════════════════ -->
	<div x-show="detailOpen" x-cloak class="fixed inset-0 z-[100] flex items-start justify-center pt-[8vh] px-4" @keydown.escape.window="detailOpen = false" role="dialog" aria-modal="true" aria-label="Task details">
		<div x-show="detailOpen" x-transition:enter="transition-opacity ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
			 x-transition:leave="transition-opacity ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
			 class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="detailOpen = false"></div>
		<div x-show="detailOpen" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-95 translate-y-2" x-transition:enter-end="opacity-100 scale-100 translate-y-0"
			 x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100 translate-y-0" x-transition:leave-end="opacity-0 scale-95 translate-y-2"
			 class="relative w-full max-w-lg bg-surface-2 rounded-xl shadow-2xl border border-border overflow-hidden">

			<!-- Status stripe -->
			<div class="h-1" :class="{
				'status-dot-TODO': detailTask.status === 'TODO',
				'status-dot-DOING': detailTask.status === 'DOING',
				'status-dot-DONE': detailTask.status === 'DONE'
			}"></div>

			<!-- Header -->
			<div class="px-6 pt-5 pb-4">
				<div class="flex items-start justify-between gap-4">
					<div class="flex-1 min-w-0">
						<div class="flex items-center gap-2.5 mb-3">
							<span class="w-2.5 h-2.5 rounded-full" :class="{
								'status-dot-TODO': detailTask.status === 'TODO',
								'status-dot-DOING': detailTask.status === 'DOING',
								'status-dot-DONE': detailTask.status === 'DONE'
							}" aria-hidden="true"></span>
							<span class="text-xs text-text-tertiary font-medium" x-text="detailTask.status"></span>
							<span class="text-xs text-text-tertiary font-mono">TF-<span x-text="detailTask.id"></span></span>
						</div>
						<template x-if="!editing">
							<h2 class="text-lg font-semibold text-text-primary leading-snug" x-text="detailTask.title"></h2>
						</template>
						<template x-if="editing">
							<input x-model="editForm.title" type="text"
								class="w-full text-lg font-semibold text-text-primary leading-snug px-3 py-2 -mx-3 rounded-lg border border-accent bg-surface-3 focus:outline-none focus:ring-2 focus:ring-accent">
						</template>
					</div>
					<button @click="detailOpen = false" class="p-1.5 rounded-lg text-text-tertiary hover:text-text-secondary hover:bg-surface-3 transition-colors cursor-pointer shrink-0" aria-label="Close">
						<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
					</button>
				</div>
			</div>

			<!-- Body -->
			<div class="px-6 pb-5 space-y-5">
				<!-- Description -->
				<div>
					<label class="block text-xs font-medium text-text-tertiary uppercase tracking-wider mb-2">Description</label>
					<template x-if="!editing">
						<p class="text-sm text-text-secondary whitespace-pre-wrap leading-relaxed" x-text="detailTask.description || 'No description provided.'"></p>
					</template>
					<template x-if="editing">
						<textarea x-model="editForm.description" rows="3"
							class="w-full text-sm text-text-secondary px-3 py-2.5 rounded-lg border border-border-strong bg-surface-3 focus:outline-none focus:ring-2 focus:ring-accent resize-none"></textarea>
					</template>
				</div>

				<!-- Meta grid -->
				<div class="grid grid-cols-2 gap-5">
					<div>
						<label class="block text-xs font-medium text-text-tertiary uppercase tracking-wider mb-2">Status</label>
						<template x-if="!editing">
							<span class="inline-flex items-center gap-1.5 text-sm font-medium text-text-primary">
								<span class="w-2 h-2 rounded-full" :class="{
									'status-dot-TODO': detailTask.status === 'TODO',
									'status-dot-DOING': detailTask.status === 'DOING',
									'status-dot-DONE': detailTask.status === 'DONE'
								}" aria-hidden="true"></span>
								<span x-text="detailTask.status"></span>
							</span>
						</template>
						<template x-if="editing">
							<select x-model="editForm.status"
								class="w-full text-sm px-3 py-2.5 rounded-lg border border-border-strong bg-surface-3 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent">
								<option value="TODO">TODO</option>
								<option value="DOING">DOING</option>
								<option value="DONE">DONE</option>
							</select>
						</template>
					</div>
					<div>
						<label class="block text-xs font-medium text-text-tertiary uppercase tracking-wider mb-2">Assignee</label>
						<template x-if="!editing">
							<div class="flex items-center gap-2">
								<div class="w-5 h-5 rounded-full bg-accent-muted text-accent flex items-center justify-center text-[9px] font-bold" x-text="detailAssignee.initials"></div>
								<span class="text-sm text-text-primary" x-text="detailAssignee.label"></span>
							</div>
						</template>
						<template x-if="editing">
							<select x-model="editForm.assigneeId"
								class="w-full text-sm px-3 py-2.5 rounded-lg border border-border-strong bg-surface-3 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent" id="detailAssigneeSelect">
								<option value="">Unassigned</option>
							</select>
						</template>
					</div>
					<div>
						<label class="block text-xs font-medium text-text-tertiary uppercase tracking-wider mb-2">Created by</label>
						<div class="flex items-center gap-2">
							<div class="w-5 h-5 rounded-full bg-surface-5 text-text-tertiary flex items-center justify-center text-[9px] font-bold" x-text="detailCreator.initials"></div>
							<span class="text-sm text-text-primary" x-text="detailCreator.label"></span>
						</div>
					</div>
					<div>
						<label class="block text-xs font-medium text-text-tertiary uppercase tracking-wider mb-2">Created</label>
						<span class="text-sm text-text-primary" x-text="detailTask.createdAt ? new Date(detailTask.createdAt).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' }) : '—'"></span>
					</div>
				</div>
			</div>

			<!-- Footer -->
			<div class="px-6 py-4 border-t border-border-subtle bg-surface-1">
				<template x-if="!editing">
					<div class="flex items-center justify-between">
						<div class="flex items-center gap-2">
							<button x-show="canDelete" @click="confirmDelete()"
								class="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors cursor-pointer">
								<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
								Delete
							</button>
						</div>
						<div class="flex items-center gap-3">
							<template x-if="canEdit && detailTask.status !== 'DONE'">
								<button @click="quickMove()" class="inline-flex items-center gap-1.5 px-4 py-2 text-sm font-medium text-text-secondary bg-surface-3 border border-border-strong rounded-lg hover:bg-surface-4 hover:text-text-primary transition-colors cursor-pointer">
									<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
									<span x-text="'Move to ' + nextStatus(detailTask.status)"></span>
								</button>
							</template>
							<button x-show="canEdit" @click="startEditing()"
								class="inline-flex items-center gap-1.5 px-4 py-2 bg-accent text-white text-sm font-medium rounded-lg hover:bg-accent-hover transition-colors cursor-pointer">
								<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
								Edit
							</button>
						</div>
					</div>
				</template>
				<template x-if="editing">
					<div class="flex items-center justify-end gap-3">
						<button @click="cancelEditing()" class="px-4 py-2 text-sm font-medium text-text-secondary bg-surface-3 border border-border-strong rounded-lg hover:bg-surface-4 transition-colors cursor-pointer">Cancel</button>
						<button @click="saveEdits()" :disabled="saving"
							class="inline-flex items-center gap-2 px-5 py-2 bg-accent text-white text-sm font-semibold rounded-lg hover:bg-accent-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer">
							<span x-text="saving ? 'Saving...' : 'Save Changes'"></span>
							<svg x-show="saving" class="animate-spin h-4 w-4 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
						</button>
					</div>
				</template>
			</div>
		</div>
	</div>

	<!-- ═══════════════════════════════════════
	     MODAL: Keyboard Shortcuts
	     ═══════════════════════════════════════ -->
	<div x-show="shortcutsOpen" x-cloak class="fixed inset-0 z-[100] flex items-center justify-center px-4" @keydown.escape.window="shortcutsOpen = false" role="dialog" aria-modal="true" aria-label="Keyboard shortcuts">
		<div x-show="shortcutsOpen" x-transition:enter="transition-opacity ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
			 x-transition:leave="transition-opacity ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
			 class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="shortcutsOpen = false"></div>
		<div x-show="shortcutsOpen" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
			 x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
			 class="relative w-full max-w-md bg-surface-2 rounded-xl shadow-2xl border border-border overflow-hidden">
			<div class="flex items-center justify-between px-6 py-4 border-b border-border-subtle">
				<h2 class="text-base font-semibold text-text-primary">Keyboard Shortcuts</h2>
				<button @click="shortcutsOpen = false" class="p-1.5 rounded-lg text-text-tertiary hover:text-text-secondary hover:bg-surface-3 transition-colors cursor-pointer" aria-label="Close">
					<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
				</button>
			</div>
			<div class="px-6 py-5">
				<div class="shortcuts-grid">
					<div class="shortcut-row"><span>New task</span><kbd class="kbd-hint">N</kbd></div>
					<div class="shortcut-row"><span>Filter tasks</span><kbd class="kbd-hint">/</kbd></div>
					<div class="shortcut-row"><span>Command palette</span><kbd class="kbd-hint">&lceil;K</kbd></div>
					<div class="shortcut-row"><span>Refresh board</span><kbd class="kbd-hint">R</kbd></div>
					<div class="shortcut-row"><span>Show shortcuts</span><kbd class="kbd-hint">?</kbd></div>
					<div class="shortcut-row"><span>Close modal</span><kbd class="kbd-hint">Esc</kbd></div>
				</div>
			</div>
		</div>
	</div>

	<script src="/assets/ui.js"></script>
</body>
</html>
