<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:x-transition="http://www.w3.org/1999/xhtml">
<body>

<!-- Command Palette (Cmd+K) -->
<div th:fragment="commandPalette"
	 x-show="$store.cmd.open" x-cloak
	 @keydown.escape.window="$store.cmd.close()"
	 class="fixed inset-0 z-[200] flex items-start justify-center pt-[20vh] px-4">

	<!-- Backdrop -->
	<div x-show="$store.cmd.open"
		 x-transition:enter="transition-opacity ease-out duration-150" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
		 x-transition:leave="transition-opacity ease-in duration-100" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
		 class="absolute inset-0 cmd-backdrop" @click="$store.cmd.close()"></div>

	<!-- Panel -->
	<div x-show="$store.cmd.open"
		 x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-95 -translate-y-2" x-transition:enter-end="opacity-100 scale-100 translate-y-0"
		 x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100 translate-y-0" x-transition:leave-end="opacity-0 scale-95 -translate-y-2"
		 class="relative w-full max-w-lg bg-surface-2 border border-border-strong rounded-xl shadow-2xl overflow-hidden"
		 x-data="commandPalette()" x-init="$watch('$store.cmd.open', v => { if(v) { query=''; selectedIndex=0; $nextTick(() => $refs.cmdInput?.focus()); } })">

		<!-- Search input -->
		<div class="flex items-center gap-3 px-4 py-3 border-b border-border-subtle">
			<svg class="w-4 h-4 text-text-tertiary flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
			<input x-ref="cmdInput" x-model="query" type="text" placeholder="Type a command or search..."
				   @keydown.arrow-down.prevent="selectedIndex = Math.min(selectedIndex + 1, filteredCommands.length - 1)"
				   @keydown.arrow-up.prevent="selectedIndex = Math.max(selectedIndex - 1, 0)"
				   @keydown.enter.prevent="if(filteredCommands[selectedIndex]) run(filteredCommands[selectedIndex])"
				   class="flex-1 bg-transparent text-sm text-text-primary placeholder-text-tertiary outline-none">
			<kbd class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-surface-4 text-text-tertiary border border-border-strong">ESC</kbd>
		</div>

		<!-- Results -->
		<div class="max-h-[300px] overflow-y-auto py-1">
			<template x-for="(cmd, i) in filteredCommands" :key="cmd.id">
				<button @click="run(cmd)" @mouseenter="selectedIndex = i"
						class="w-full flex items-center gap-3 px-4 py-2.5 text-left transition-colors duration-75"
						:class="i === selectedIndex ? 'bg-accent-muted text-text-primary' : 'text-text-secondary hover:bg-surface-3'">
					<div class="w-5 h-5 flex items-center justify-center flex-shrink-0 opacity-70" x-html="cmd.icon"></div>
					<span class="flex-1 text-sm" x-text="cmd.label"></span>
					<span x-show="cmd.shortcut" class="text-[10px] text-text-tertiary font-mono" x-text="cmd.shortcut"></span>
				</button>
			</template>
			<div x-show="filteredCommands.length === 0" class="px-4 py-8 text-center">
				<p class="text-sm text-text-tertiary">No results found</p>
			</div>
		</div>
	</div>
</div>

</body>
</html>
